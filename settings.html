<!DOCTYPE html>
<html lang="en">

<head>
    <title>Zerra Launcher - Settings</title>
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/settings.css">
</head>

<body>
    <div id="wrapper">
        <form id="settings">
            <div class="row">
                <div class="col-3">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <a class="nav-link active show" id="v-pills-options-tab" data-toggle="pill" href="#v-pills-options" role="tab" aria-controls="v-pills-options"
                            aria-selected="false">Options</a>
                        <a class="nav-link" id="v-pills-updates-tab" data-toggle="pill" href="#v-pills-updates" role="tab" aria-controls="v-pills-updates"
                            aria-selected="false">Updates</a>
                        <a class="nav-link" id="v-pills-networking-tab" data-toggle="pill" href="#v-pills-networking" role="tab" aria-controls="v-pills-networking"
                            aria-selected="false">Networking</a>
                        <a class="nav-link" id="v-pills-about-tab" data-toggle="pill" href="#v-pills-about" role="tab" aria-controls="v-pills-about"
                            aria-selected="true">About</a>
                    </div>
                </div>
                <div class="col-9">
                    <div class="tab-content content" id="v-pills-tabContent">
                        <div class="tab-pane active fade show" id="v-pills-options" role="tabpanel" aria-labelledby="v-pills-options-tab">
                            <fieldset class="form-group">
                                <legend>Launcher Options</legend>

                                <label class="form-check-label">
                                    <input type="checkbox" class="form-check-input" name="NotifyUpdates" id="NotifyUpdates"> Notify me when an update for the launcher begins.
                                </label>
                                <br>
                                <label class="form-check-label">
                                    <input type="checkbox" class="form-check-input" name="NoLaunchDuringUpdate" id="NoLaunchDuringUpdate"> Prevent launching during an update.
                                </label>
                                <br>
                                <label class="form-check-label">
                                    <input type="checkbox" class="form-check-input" name="RememberEmail" id="RememberEmail"> Remember my email address.
                                </label>
                                <br>
                                <label class="form-check-label">
                                    <input type="checkbox" class="form-check-input" name="KeepLoggedIn" id="KeepLoggedIn"> Keep me logged in.
                                </label>
                                <br>
                                <label class="form-check-label">
                                    <input type="checkbox" class="form-check-input" name="SendCrashReports" id="SendCrashReports"> Automatically send crash report info to developers.
                                </label>
                            </fieldset>
                        </div>
                        <div class="tab-pane fade" id="v-pills-updates" role="tabpanel" aria-labelledby="v-pills-updates-tab">
                            <fieldset class="form-group">
                                <legend>Automatic Updates</legend>
                                <div class="form-check">
                                    <label class="form-check-label">
                                        <input type="radio" class="form-check-input" name="AutomaticUpdates" id="NeverAutoUpdate" value="NeverAutoUpdate"> Never automatically update.
                                    </label>
                                </div>
                                <div class="form-check">
                                    <label class="form-check-label">
                                        <input type="radio" class="form-check-input" name="AutomaticUpdates" id="AutoUpdate" value="AutoUpdate"> Always update to the latest and greatest.
                                    </label>
                                </div>
                                <div class="form-check disabled">
                                    <label class="form-check-label">
                                        <input type="radio" class="form-check-input" name="AutomaticUpdates" id="AutoUpdateToUnstable" value="AutoUpdateToUnstable"> Automatically update to unstable versions. I like to live on the edge.
                                    </label>
                                </div>
                            </fieldset>
                        </div>
                        <div class="tab-pane fade" id="v-pills-networking" role="tabpanel" aria-labelledby="v-pills-networking-tab">
                            <fieldset class="form-group ">
                                <legend>Network Bandwidth</legend>
                                <p>
                                    <input type="text" id="maxBandwidth" aria-describedby="maxBandwidth" placeholder="Maximum Bandwidth" name="MaximumBandwidth"
                                        id="MaximumBandwidth">
                                    <label for="maxBandwidth">&nbsp;KB/s</label>
                                </p>
                                <small id="emailHelp" class="form-text text-muted">Leaving 0 for maximum will make the bandwidth unlimited.</small>
                            </fieldset>
                        </div>
                        <div class="tab-pane fade" id="v-pills-about" role="tabpanel" aria-labelledby="v-pills-about-tab">
                            <p>
                                Lorem ipsum dolor sit amet, luptatum adolescens argumentum vel eu, quis erant philosophia cum eu, ne oratio forensibus per.
                                Vero efficiantur his ad. Eu tantas feugait cum, nobis impetus quo an. Elit reformidans at
                                ius, decore delicata senserit ius te, id erant scribentur duo. Ex quo solet delectus quaestio,
                                ex habeo altera senserit has. Vide fabulas duo et, ut elit mandamus conceptam duo, sea dicit
                                laudem vulputate eu. Quo eu odio tation ignota. Ius solet eirmod accusam cu, ex novum interesset
                                nam. Ne duo docendi copiosae disputationi. Id est malorum interesset. Mucius democritum vituperata
                                mea no, ne habemus signiferumque vis. Ei his possim lobortis indoctum. Ullum tibique has
                                ne. Ex sea facilisi voluptatibus, est no vero nemore suscipit. Nibh audire pericula nam eu,
                                cu has persius consectetuer. In solet elaboraret ius, postea viderer ei vel, insolens percipitur
                                mea no. In usu nihil scripta adversarium. Mei id stet euismod cotidieque, ne errem referrentur
                                conclusionemque mei. Per ferri nonumy an, ius eu altera graeci, cetero atomorum ad qui. Ex
                                vel malorum fabulas fabellas, nullam apeirian eum ex. Putent accusam et his, an eam malorum
                                nonumes. Te ius stet consequat, vis no primis semper antiopam, qui voluptaria contentiones
                                ei. Ei pro homero adipiscing, in eum rebum justo nullam. Nostrud ocurreret referrentur in
                                eos, at modo posse cum. Eius iudico volumus sit an, nam munere prompta suavitate at, cu hinc
                                prompta eum. Eum ipsum exerci ea, an qui prima audiam utroque, his ei appareat menandri.
                                Docendi tractatos ne cum, ne liberavisse intellegebat mea. Qui ei ferri honestatis. Qui ne
                                insolens intellegebat. Pri affert aeterno ex, no euismod assentior mei, eu est tale timeam.
                                Quem harum altera vis ex, tempor convenire elaboraret quo id. Pri praesent signiferumque
                                at. Eam veniam fabellas forensibus ea. Natum lorem est eu, graece atomorum mel at. Perpetua
                                mnesarchum consetetur his no, cu graece dolores sea, cum gloriatur referrentur eu. Sed etiam
                                aliquam explicari te, summo nonumy molestiae in eum. Vide dolores his in, ex pro ornatus
                                accusam. Mucius neglegentur id nec, prima imperdiet in has. Vis in mollis iriure disputando,
                                mollis theophrastus mei ut. Quas adversarium eum ex, graecis fabellas id sed. No clita corrumpit
                                cum, et ludus dicam mei. Melius volumus cum et, vix paulo deserunt electram ei, oblique partiendo
                                explicari cu mel. Sit cu vero putant ancillae, cum atqui periculis urbanitas te. Ut vix ubique
                                graeci legimus, vel ex option insolens. Pri aeque patrioque ut, bonorum recusabo eu per.
                                No vix malorum incorrupte. Eius aliquip in qui. Id nam nominati rationibus, ex sea solum
                                impedit noluisse. Ne persecuti dissentiet duo, eu est blandit menandri.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <button type="button" onclick="saveSettings()" id="save" class="btn btn-success">Save</button>

        </form>
    </div>

    <script>
        window.jQuery = window.$ = require('jquery');

        const fs = require('fs');

        var path = 'C:/Users/' + process.env.username + '/AppData/Roaming/.zerra/Launcher/Settings/settings.json';
        var def = 'defaults/settings.json';

        const form = document.getElementById('settings');

        //Automatically set the values of the form according to the settings, if they exist.
        if (fs.existsSync(path)) {
            fs.readFile(path, 'utf8', function (err, data) {
                if (err) {
                    return console.log(err);
                }

                var jsonSettings = JSON.parse(data);

                var elements = form.querySelectorAll("input, select, textarea");

                for (var i = 0; i < elements.length; i++) {

                    var element = elements[i];

                    var value = jsonSettings[element.name];

                    if (element.type === 'checkbox') {
                        if (value == true) {
                            element.checked = true;
                            console.log('set checkbox with name ' + element.name + ' to true.');
                        } else {
                            element.checked = false;
                            console.log('set checkbox with name ' + element.name + ' to false.');
                        }
                    } else if (element.type === 'radio') {
                        if (jsonSettings[element.name] == element.id) {
                            element.checked = true;
                            console.log('set checkbox with name ' + element.name + ' to true.');
                        }
                    } else if (element.type === 'text') {
                        element.value = value;
                    }
                }
                console.log(jsonSettings);
            });
        } else {
            fs.readFile(def, 'utf8', function (err, data) {
                if (err) {
                    return console.log(err);
                }

                var jsonSettings = JSON.parse(data);

                var elements = form.querySelectorAll("input, select, textarea");

                for (var i = 0; i < elements.length; i++) {

                    var element = elements[i];

                    var value = jsonSettings[element.name];

                    if (element.type === 'checkbox') {
                        if (value == true) {
                            element.checked = true;
                            console.log('set checkbox with name ' + element.name + ' to true.');
                        } else {
                            element.checked = false;
                            console.log('set checkbox with name ' + element.name + ' to false.');
                        }
                    } else if (element.type === 'radio') {
                        if (jsonSettings[element.name] == element.id) {
                            element.checked = true;
                            console.log('set checkbox with name ' + element.name + ' to true.');
                        }
                    } else if (element.type === 'text') {
                        element.value = value;
                    }
                }
                console.log(jsonSettings);
            });
        }


        //Save the settings of the form once the user presses the save button.
        function saveSettings() {

            const data = toJSONString(form);

            //Writing to the settings file.

            if (fs.existsSync(path)) {
                fs.writeFileSync(path, data, { flag: 'w' }, function (err) {
                    if (err) {
                        console.log(err);
                    } else {
                        console.log('The file was saved!');
                    }
                });
            } else {
                fs.writeFileSync(path, data, { flag: 'wx' }, function (err) {
                    if (err) {
                        console.log(err);
                    } else {
                        console.log('The file was saved!');
                    }
                });
            }

            const remote = require('electron').remote;
            var window = remote.getCurrentWindow();
            window.close();
        }

        //Convert the form to a JSON format.
        function toJSONString(form) {

            var obj = {};

            var elements = form.querySelectorAll("input, select, textarea");

            for (var i = 0; i < elements.length; ++i) {
                var element = elements[i];
                var name = element.name;

                var value = null;
                if (element.type === 'checkbox') {
                    if (element.checked) {
                        value = true;
                    } else {
                        value = false;
                    }
                    //We want the bandwidth to be a number, not a string.
                } else if (element.name == "MaximumBandwidth") {
                    value = parseInt(element.value, 10);
                } else if (element.type === "radio") {

                    //Radio buttons are wonky to work with, so this check system makes them less of a pain to write to JSON.
                    if (element.checked == true) {
                        value = element.value;
                        if (name) {
                            obj[name] = value;
                        }
                    }
                }

                //Exclude radio buttons.
                if (element.type !== 'radio') {
                    if (name) {
                        obj[name] = value;
                    }
                }

            }

            return JSON.stringify(obj);
        }

    </script>
    <script src="node_modules/popper.js/dist/umd/popper.js"></script>
    <script src="node_modules/bootstrap/dist/js/bootstrap.js"></script>
</body>

</html>